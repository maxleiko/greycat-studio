{"version":3,"sources":["../../js/packages/greycat-lang-monaco/dist/esm/workerManager.js","../../js/packages/greycat-lang-monaco/dist/esm/languageFeatures.js","../../js/packages/greycat-lang-monaco/dist/esm/gcMode.js"],"names":["workerManager","WorkerManager","defaults","_this","this","_defaults","_worker","_idleCheckInterval","setInterval","_checkIfIdle","_lastUsedTime","_configChangeListener","onDidChange","_stopWorker","prototype","dispose","clearInterval","_client","Date","now","_getClient","monaco","editor","createWebWorker","moduleId","label","languageId","createData","languageSettings","settings","types","gcTypes","functions","gcFunctions","getProxy","getLanguageServiceWorker","resources","_i","arguments","length","p","completeCallback","errorCallback","r","Promise","c","e","then","toShallowCancelPromise","client","withSyncedResources","Range","monarchTokens","defaultToken","tokenPostfix","keywords","typeKeywords","operators","symbols","escapes","digits","octaldigits","binarydigits","hexdigits","regexpctl","regexpesc","tokenizer","root","include","common","cases","@typeKeywords","@keywords","@default","@operators","whitespace","comment","jsdoc","string_double","string_single","string_backtick","token","next","bracketCounting","DiagnosticAdapter","_languageId","_disposables","_listener","onModelAdd","model","handle","modeId","getModeId","uri","toString","onDidChangeContent","clearTimeout","setTimeout","_doValidate","onModelRemoved","setModelMarkers","uriStr","listener","push","onDidCreateModel","onWillDisposeModel","onDidChangeModelLanguage","event","Object","keys","forEach","k","_","getModels","d","resource","worker","getModel","doValidation","diagnostics","markers","map","diag","code","String","severity","lsSeverity","main","Error","MarkerSeverity","Warning","Information","Hint","Info","toSeverity","startLineNumber","range","start","line","startColumn","character","endLineNumber","end","endColumn","message","source","toDiagnostics","done","undefined","err","console","error","fromPosition","position","column","lineNumber","toRange","languageFeatures_CompletionAdapter","CompletionAdapter","defineProperty","get","enumerable","configurable","provideCompletionItems","wireCancellationToken","pos","doComplete","isIncomplete","items","cList","entry","item","insertText","sortText","filterText","documentation","detail","kind","mItemKind","languages","CompletionItemKind","Text","Method","Function","Constructor","Field","Variable","Class","Interface","Module","Property","Unit","Value","Enum","Keyword","Snippet","Color","File","Reference","toCompletionItemKind","textEdit","newText","insertTextFormat","value","HoverAdapter","provideHover","doHover","info","contents","Array","isArray","toMarkdownString","toMarkedStringArray","thing","replace","language","promise","onCancellationRequested","cancel","setupMode","first","more","apply","concat","setMonarchTokensProvider","registerCompletionItemProvider","registerHoverProvider","__webpack_require__","__webpack_exports__"],"mappings":"8FAAA,IAoEeA,EAnEf,WACA,SAAAC,EAAAC,GACA,IAAAC,EAAAC,KACAA,KAAAC,UAAAH,EACAE,KAAAE,QAAA,KACAF,KAAAG,mBAAAC,YAAA,WAA2D,OAAAL,EAAAM,gBAA+B,KAC1FL,KAAAM,cAAA,EACAN,KAAAO,sBAAAP,KAAAC,UAAAO,YAAA,WAA6E,OAAAT,EAAAU,gBA0D7E,OAxDAZ,EAAAa,UAAAC,QAAA,WACAC,cAAAZ,KAAAG,oBACAH,KAAAO,sBAAAI,UACAX,KAAAS,eAEAZ,EAAAa,UAAAD,YAAA,WACAT,KAAAE,UACAF,KAAAE,QAAAS,UACAX,KAAAE,QAAA,MAEAF,KAAAa,QAAA,MAEAhB,EAAAa,UAAAL,aAAA,WACAL,KAAAE,UAGAY,KAAAC,MAAAf,KAAAM,cA1BA,MA4BAN,KAAAS,gBAGAZ,EAAAa,UAAAM,WAAA,WAiBA,OAhBAhB,KAAAM,cAAAQ,KAAAC,MACAf,KAAAa,UACAb,KAAAE,QAAAe,OAAAC,OAAAC,gBAAA,CAEAC,SAAA,iBACAC,MAAArB,KAAAC,UAAAqB,WAEAC,WAAA,CACAD,WAAAtB,KAAAC,UAAAqB,WACAE,iBAAAxB,KAAAC,UAAAwB,SACAC,MAAA1B,KAAAC,UAAA0B,QACAC,UAAA5B,KAAAC,UAAA4B,eAGA7B,KAAAa,QAAAb,KAAAE,QAAA4B,YAEA9B,KAAAa,SAEAhB,EAAAa,UAAAqB,yBAAA,WAGA,IAFA,IAKAlB,EALAd,EAAAC,KACAgC,EAAA,GACAC,EAAA,EAAwBA,EAAAC,UAAAC,OAAuBF,IAC/CD,EAAAC,GAAAC,UAAAD,GAGA,OAYA,SAAAG,GACA,IAAAC,EAAA,aAGAC,EAAA,aAGAC,EAAA,IAAAtB,OAAAuB,QAAA,SAAAC,EAAAC,GACAL,EAAAI,EACAH,EAAAI,GACK,cAEL,OADAN,EAAAO,KAAAN,EAAAC,GACAC,EAxBAK,CAAA5C,KAAAgB,aACA2B,KAAA,SAAAE,GAAqC,OAAAhC,EAAAgC,IACrCF,KAAA,WACA5C,EAAAG,SACAH,EAAAG,QAAA4C,oBAAAd,KAGAW,KAAA,WAA+B,OAAA9B,MAE/BhB,EAjEA,gBCAAkD,EAAA9B,OAAA8B,MACOC,EAAA,CAEPC,aAAA,UACAC,aAAA,MACAC,SAAA,CACA,OACA,OACA,WACA,MACA,MACA,OACA,SACA,OACA,OACA,QACA,OACA,UACA,cACA,SACA,SACA,UACA,KACA,QACA,OACA,QAEAC,aAAA,CACA,SACA,eACA,MACA,YACA,OACA,aACA,OACA,aACA,SACA,eACA,OACA,aACA,QACA,cACA,YACA,YACA,MACA,YAEAC,UAAA,CACA,IACA,IACA,KACA,KACA,KACA,KACA,MACA,MACA,KACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KACA,KACA,KACA,KACA,KACA,KAGAC,QAAA,wBACAC,QAAA,wEACAC,OAAA,cACAC,YAAA,oBACAC,aAAA,oBACAC,UAAA,iCACAC,UAAA,yBACAC,UAAA,+EAEAC,UAAA,CACAC,KAAA,SAAoB,sBAA2BC,QAAA,WAC/CC,OAAA,CAEA,CACA,gBACA,CACAC,MAAA,CACAC,gBAAA,UACAC,YAAA,UACAC,WAAA,gBAIA,yBACA,mCAGA,CAAaL,QAAA,eAEb,yBACA,iCACA,CACA,WACA,CACAE,MAAA,CACAI,aAAA,YACAD,WAAA,MAKA,mDACA,8DACA,uBAEA,UAAgB,aAEhB,qCACA,qCACA,gCACA,gCACA,mCAEAE,WAAA,CACA,kBACA,wCACA,8BACA,uBAEAC,QAAA,sEACAC,MAAA,kFACAC,cAAA,CACA,qBACA,6BACA,gCACA,uBAEAC,cAAA,CACA,qBACA,6BACA,gCACA,uBAEAC,gBAAA,CACA,QAAkB,CAAIC,MAAA,oBAAAC,KAAA,qBACtB,sBACA,6BACA,gCACA,uBAEAC,gBAAA,CACA,MAAgB,wCAChB,MAAgB,4BAChB,CAAaf,QAAA,aA6KbgB,EAAA,WACA,SAAAA,EAAAC,EAAA/E,EAAAJ,GACA,IAAAC,EAAAC,KACAA,KAAAiF,cACAjF,KAAAE,UACAF,KAAAkF,aAAA,GACAlF,KAAAmF,UAAA,GACA,IAAAC,EAAA,SAAAC,GACA,IAIAC,EAJAC,EAAAF,EAAAG,YACAD,IAAAxF,EAAAkF,cAIAlF,EAAAoF,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","file":"static/js/49.8c9fd16d.chunk.js","sourcesContent":["var STOP_WHEN_IDLE_FOR = 2 * 60 * 1000; // 2min\nvar WorkerManager = /** @class */ (function () {\n    function WorkerManager(defaults) {\n        var _this = this;\n        this._defaults = defaults;\n        this._worker = null;\n        this._idleCheckInterval = setInterval(function () { return _this._checkIfIdle(); }, 30 * 1000);\n        this._lastUsedTime = 0;\n        this._configChangeListener = this._defaults.onDidChange(function () { return _this._stopWorker(); });\n    }\n    WorkerManager.prototype.dispose = function () {\n        clearInterval(this._idleCheckInterval);\n        this._configChangeListener.dispose();\n        this._stopWorker();\n    };\n    WorkerManager.prototype._stopWorker = function () {\n        if (this._worker) {\n            this._worker.dispose();\n            this._worker = null;\n        }\n        this._client = null;\n    };\n    WorkerManager.prototype._checkIfIdle = function () {\n        if (!this._worker) {\n            return;\n        }\n        var timePassedSinceLastUsed = Date.now() - this._lastUsedTime;\n        if (timePassedSinceLastUsed > STOP_WHEN_IDLE_FOR) {\n            this._stopWorker();\n        }\n    };\n    WorkerManager.prototype._getClient = function () {\n        this._lastUsedTime = Date.now();\n        if (!this._client) {\n            this._worker = monaco.editor.createWebWorker({\n                // module that exports the create() method and returns a `GreyCatWorker` instance\n                moduleId: 'greycat.worker',\n                label: this._defaults.languageId,\n                // passed in to the create() method\n                createData: {\n                    languageId: this._defaults.languageId,\n                    languageSettings: this._defaults.settings,\n                    types: this._defaults.gcTypes,\n                    functions: this._defaults.gcFunctions,\n                },\n            });\n            this._client = this._worker.getProxy();\n        }\n        return this._client;\n    };\n    WorkerManager.prototype.getLanguageServiceWorker = function () {\n        var _this = this;\n        var resources = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            resources[_i] = arguments[_i];\n        }\n        var _client;\n        return toShallowCancelPromise(this._getClient()\n            .then(function (client) { return (_client = client); })\n            .then(function () {\n            if (_this._worker) {\n                _this._worker.withSyncedResources(resources);\n            }\n        })\n            .then(function () { return _client; }));\n    };\n    return WorkerManager;\n}());\nexport default WorkerManager;\nfunction toShallowCancelPromise(p) {\n    var completeCallback = function () {\n        /*noop*/\n    };\n    var errorCallback = function () {\n        /*noop*/\n    };\n    var r = new monaco.Promise(function (c, e) {\n        completeCallback = c;\n        errorCallback = e;\n    }, function () { });\n    p.then(completeCallback, errorCallback);\n    return r;\n}\n//# sourceMappingURL=workerManager.js.map","import * as ls from 'vscode-languageserver-types';\nvar Range = monaco.Range;\nexport var monarchTokens = {\n    // Set defaultToken to invalid to see what you do not tokenize yet\n    defaultToken: 'invalid',\n    tokenPostfix: '.js',\n    keywords: [\n        'open',\n        'type',\n        'function',\n        'var',\n        'new',\n        'gnew',\n        'return',\n        'null',\n        'this',\n        'false',\n        'true',\n        'foreach',\n        'csv_foreach',\n        'repeat',\n        'static',\n        'private',\n        'if',\n        'while',\n        'then',\n        'else',\n    ],\n    typeKeywords: [\n        'string',\n        'string_array',\n        'int',\n        'int_array',\n        'bool',\n        'bool_array',\n        'long',\n        'long_array',\n        'double',\n        'double_array',\n        'node',\n        'node_array',\n        'ulong',\n        'ulong_array',\n        'ref_array',\n        'reference',\n        'any',\n        'any_node',\n    ],\n    operators: [\n        '<',\n        '>',\n        '<=',\n        '>=',\n        '==',\n        '!=',\n        '===',\n        '!==',\n        '=>',\n        '+',\n        '-',\n        '*',\n        '/',\n        '%',\n        '!',\n        ':',\n        '=',\n        '+=',\n        '-=',\n        '*=',\n        '/=',\n        '%=',\n        '#',\n    ],\n    // we include these common regular expressions\n    symbols: /[=><!~?:&|+\\-*\\/\\^%]+/,\n    escapes: /\\\\(?:[abfnrtv\\\\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,\n    digits: /\\d+(_+\\d+)*/,\n    octaldigits: /[0-7]+(_+[0-7]+)*/,\n    binarydigits: /[0-1]+(_+[0-1]+)*/,\n    hexdigits: /[[0-9a-fA-F]+(_+[0-9a-fA-F]+)*/,\n    regexpctl: /[(){}\\[\\]\\$\\^|\\-*+?\\.]/,\n    regexpesc: /\\\\(?:[bBdDfnrstvwWn0\\\\\\/]|@regexpctl|c[A-Z]|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})/,\n    // The main tokenizer for our languages\n    tokenizer: {\n        root: [[/[{}]/, 'delimiter.bracket'], { include: 'common' }],\n        common: [\n            // identifiers and keywords\n            [\n                /[a-z_$][\\w$]*/,\n                {\n                    cases: {\n                        '@typeKeywords': 'keyword',\n                        '@keywords': 'keyword',\n                        '@default': 'identifier',\n                    },\n                },\n            ],\n            [/#[\\w\\$]*/, 'type.meta'],\n            [/[A-Z][\\w\\$]*/, 'type.identifier'],\n            // [/[A-Z][\\w\\$]*/, 'identifier'],\n            // whitespace\n            { include: '@whitespace' },\n            // delimiters and operators\n            [/[()\\[\\]]/, '@brackets'],\n            [/[<>](?!@symbols)/, '@brackets'],\n            [\n                /@symbols/,\n                {\n                    cases: {\n                        '@operators': 'delimiter',\n                        '@default': '',\n                    },\n                },\n            ],\n            // numbers\n            [/(@digits)[eE]([\\-+]?(@digits))?/, 'number.float'],\n            [/(@digits)\\.(@digits)([eE][\\-+]?(@digits))?/, 'number.float'],\n            [/(@digits)/, 'number'],\n            // delimiter: after number because of .\\d floats\n            [/[;,\\.]/, 'delimiter'],\n            // strings\n            [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'],\n            [/'([^'\\\\]|\\\\.)*$/, 'string.invalid'],\n            [/\"/, 'string', '@string_double'],\n            [/'/, 'string', '@string_single'],\n            [/`/, 'string', '@string_backtick'],\n        ],\n        whitespace: [\n            [/[ \\t\\r\\n]+/, ''],\n            [/\\/\\*\\*(?!\\/)/, 'comment.doc', '@jsdoc'],\n            [/\\/\\*/, 'comment', '@comment'],\n            [/\\/\\/.*$/, 'comment'],\n        ],\n        comment: [[/[^\\/*]+/, 'comment'], [/\\*\\//, 'comment', '@pop'], [/[\\/*]/, 'comment']],\n        jsdoc: [[/[^\\/*]+/, 'comment.doc'], [/\\*\\//, 'comment.doc', '@pop'], [/[\\/*]/, 'comment.doc']],\n        string_double: [\n            [/[^\\\\\"]+/, 'string'],\n            [/@escapes/, 'string.escape'],\n            [/\\\\./, 'string.escape.invalid'],\n            [/\"/, 'string', '@pop'],\n        ],\n        string_single: [\n            [/[^\\\\']+/, 'string'],\n            [/@escapes/, 'string.escape'],\n            [/\\\\./, 'string.escape.invalid'],\n            [/'/, 'string', '@pop'],\n        ],\n        string_backtick: [\n            [/\\$\\{/, { token: 'delimiter.bracket', next: '@bracketCounting' }],\n            [/[^\\\\`$]+/, 'string'],\n            [/@escapes/, 'string.escape'],\n            [/\\\\./, 'string.escape.invalid'],\n            [/`/, 'string', '@pop'],\n        ],\n        bracketCounting: [\n            [/\\{/, 'delimiter.bracket', '@bracketCounting'],\n            [/\\}/, 'delimiter.bracket', '@pop'],\n            { include: 'common' },\n        ],\n    },\n};\n// {\n//   // Set defaultToken to invalid to see what you do not tokenize yet\n//   defaultToken: 'invalid',\n//   keywords: [\n//     'type',\n//     'function',\n//     'var',\n//     'new',\n//     'gnew',\n//     'return',\n//     'null',\n//     'this',\n//     'false',\n//     'true',\n//     'foreach',\n//     'csv_foreach',\n//     'repeat',\n//     'static',\n//     'private',\n//     'if',\n//     'then',\n//     'else',\n//   ],\n//   typeKeywords: [//   // brackets\n//   brackets: [\n//     {\n//       open: '{',\n//       close: '}',\n//       token: 'delimiter.curly',\n//     },\n//     {\n//       open: '(',\n//       close: ')',\n//       token: 'delimiter.paren',\n//     },\n//     {\n//       open: '[',\n//       close: ']',\n//       token: 'delimiter.square',\n//     },\n//     {\n//       open: '<',\n//       close: '>',\n//       token: 'delimiter.angle',\n//     },\n//   ],\n//     'string',\n//     'string_array',\n//     'int',\n//     'int_array',\n//     'bool',\n//     'bool_array',\n//     'long',\n//     'long_array',\n//     'double',\n//     'double_array',\n//     'node',\n//     'node_array',\n//     'ulong',\n//     'ulong_array',\n//     'ref_array',\n//     'reference',\n//     'any',\n//     'any_node',\n//   ],\n//   operators: ['%', '+', '-', '!', '=', '#', '==', '!=', '<=', '>='],\n//   // we include these common regular expressions\n//   symbols: /[;~!@#%\\^&*\\-+=|\\\\:`<>.?\\/]+/,\n//   // javascript style strings\n//   escapes: /\\\\(?:[btnfr\\\\\"'`]|[0-7][0-7]?|[0-3][0-7]{2})/,\n//   // brackets\n//   brackets: [\n//     {\n//       open: '{',\n//       close: '}',\n//       token: 'delimiter.curly',\n//     },\n//     {\n//       open: '(',\n//       close: ')',\n//       token: 'delimiter.paren',\n//     },\n//     {\n//       open: '[',\n//       close: ']',\n//       token: 'delimiter.square',\n//     },\n//     {\n//       open: '<',\n//       close: '>',\n//       token: 'delimiter.angle',\n//     },\n//   ],\n//   // The main tokenizer for our languages\n//   tokenizer: {\n//     root: [\n//       // identifiers and keywords\n//       [\n//         /[a-z_$][\\w$]*/,\n//         {\n//           cases: {\n//             '@typeKeywords': 'keyword',\n//             '@keywords': 'keyword',\n//             '@default': 'identifier',\n//           },\n//         },\n//       ],\n//       [/[A-Z][\\w\\$]*/, 'type.identifier'], // to show class names nicely\n//       [/#[\\w$]*/, 'hash.identifier'], // to hash identifier\n//       // whitespace\n//       {\n//         include: '@whitespace',\n//       },\n//       // delimiters and operators\n//       [/[{}()\\[\\]]/, '@brackets'],\n//       [/[<>](?!@symbols)/, '@brackets'],\n//       [\n//         /@symbols/,\n//         {\n//           cases: {\n//             '@operators': 'operator',\n//             '@default': '',\n//           },\n//         },\n//       ],\n//       // numbers\n//       [/\\d*\\.\\d+([eE][\\-+]?\\d+)?/, 'number.float'],\n//       [/\\d+/, 'number'],\n//       // delimiter: after number because of .\\d floats\n//       [/[,.]/, 'delimiter'],\n//       // strings: recover on non-terminated strings\n//       [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'], // non-teminated string\n//       [/'([^'\\\\]|\\\\.)*$/, 'string.invalid'], // non-teminated string\n//       [/`([^`\\\\]|\\\\.)*$/, 'string.invalid'], // non-teminated string\n//       [/\"/, 'string', '@string.\"'],\n//       [/'/, 'string', \"@string.'\"],\n//       [/`/, 'string', \"@string.'\"],\n//       // characters\n//       [/'[^\\\\']'/, 'string'],\n//       [/(')(@escapes)(')/, ['string', 'string.escape', 'string']],\n//       [/'/, 'string.invalid'],\n//     ],\n//     comment: [\n//       [/[^\\/*]+/, 'comment'],\n//       [/\\/\\*/, 'comment', '@push'], // nested comment\n//       [/\\\\*\\//, 'comment', '@pop'],\n//       [/[\\/*]/, 'comment'],\n//     ],\n//     string: [\n//       [/[^\\\\\"'`]+/, 'string'],\n//       [/@escapes/, 'string.escape'],\n//       [/\\\\./, 'string.escape.invalid'],\n//       [\n//         /[\"'`]/,\n//         {\n//           cases: {\n//             '$#==$S2': {\n//               token: 'string',\n//               next: '@pop',\n//             },\n//             '@default': 'string',\n//           },\n//         },\n//       ],\n//     ],\n//     whitespace: [[/[ \\t\\r\\n]+/, 'white'], [/\\/\\*/, 'comment', '@comment'], [/\\/\\/.*$/, 'comment']],\n//   },\n// } as monaco.languages.IMonarchLanguage;\n// --- diagnostics --- ---\nvar DiagnosticAdapter = /** @class */ (function () {\n    function DiagnosticAdapter(_languageId, _worker, defaults) {\n        var _this = this;\n        this._languageId = _languageId;\n        this._worker = _worker;\n        this._disposables = [];\n        this._listener = {};\n        var onModelAdd = function (model) {\n            var modeId = model.getModeId();\n            if (modeId !== _this._languageId) {\n                return;\n            }\n            var handle;\n            _this._listener[model.uri.toString()] = model.onDidChangeContent(function () {\n                clearTimeout(handle);\n                handle = setTimeout(function () { return _this._doValidate(model.uri, modeId); }, 500);\n            });\n            _this._doValidate(model.uri, modeId);\n        };\n        var onModelRemoved = function (model) {\n            monaco.editor.setModelMarkers(model, _this._languageId, []);\n            var uriStr = model.uri.toString();\n            var listener = _this._listener[uriStr];\n            if (listener) {\n                listener.dispose();\n                delete _this._listener[uriStr];\n            }\n        };\n        this._disposables.push(monaco.editor.onDidCreateModel(onModelAdd));\n        this._disposables.push(monaco.editor.onWillDisposeModel(onModelRemoved));\n        this._disposables.push(monaco.editor.onDidChangeModelLanguage(function (event) {\n            onModelRemoved(event.model);\n            onModelAdd(event.model);\n        }));\n        this._disposables.push({\n            dispose: function () {\n                Object.keys(_this._listener).forEach(function (k) {\n                    _this._listener[k].dispose();\n                });\n            },\n        });\n        defaults.onDidChange(function (_) {\n            monaco.editor.getModels().forEach(function (model) {\n                if (model.getModeId() === _this._languageId) {\n                    onModelRemoved(model);\n                    onModelAdd(model);\n                }\n            });\n        });\n        monaco.editor.getModels().forEach(onModelAdd);\n    }\n    DiagnosticAdapter.prototype.dispose = function () {\n        this._disposables.forEach(function (d) { return d && d.dispose(); });\n        this._disposables = [];\n    };\n    DiagnosticAdapter.prototype._doValidate = function (resource, languageId) {\n        this._worker(resource)\n            .then(function (worker) {\n            if (!monaco.editor.getModel(resource)) {\n                // model was disposed in the meantime\n                return null;\n            }\n            return worker.doValidation(resource.toString());\n        })\n            .then(function (diagnostics) {\n            if (diagnostics) {\n                var markers = diagnostics.map(function (d) { return toDiagnostics(resource, d); });\n                monaco.editor.setModelMarkers(monaco.editor.getModel(resource), languageId, markers);\n            }\n        })\n            .done(undefined, function (err) {\n            // tslint:disable-next-line:no-console\n            console.error(err);\n        });\n    };\n    return DiagnosticAdapter;\n}());\nexport { DiagnosticAdapter };\nfunction toSeverity(lsSeverity) {\n    switch (lsSeverity) {\n        case ls.DiagnosticSeverity.Error:\n            return monaco.MarkerSeverity.Error;\n        case ls.DiagnosticSeverity.Warning:\n            return monaco.MarkerSeverity.Warning;\n        case ls.DiagnosticSeverity.Information:\n        case ls.DiagnosticSeverity.Hint:\n        default:\n            return monaco.MarkerSeverity.Info;\n    }\n}\nfunction toDiagnostics(resource, diag) {\n    var code = typeof diag.code === 'number' ? String(diag.code) : diag.code;\n    return {\n        severity: toSeverity(diag.severity),\n        startLineNumber: diag.range.start.line,\n        startColumn: diag.range.start.character,\n        endLineNumber: diag.range.end.line,\n        endColumn: diag.range.end.character + 1,\n        message: diag.message,\n        code: code,\n        source: diag.source,\n    };\n}\n// --- completion ------\nfunction fromPosition(position) {\n    if (!position) {\n        return void 0;\n    }\n    return { character: position.column - 1, line: position.lineNumber - 1 };\n}\nfunction toRange(range) {\n    if (!range) {\n        return void 0;\n    }\n    return new Range(range.start.line + 1, range.start.character + 1, range.end.line + 1, range.end.character + 1);\n}\nfunction toCompletionItemKind(kind) {\n    var mItemKind = monaco.languages.CompletionItemKind;\n    switch (kind) {\n        case ls.CompletionItemKind.Text:\n            return mItemKind.Text;\n        case ls.CompletionItemKind.Method:\n            return mItemKind.Method;\n        case ls.CompletionItemKind.Function:\n            return mItemKind.Function;\n        case ls.CompletionItemKind.Constructor:\n            return mItemKind.Constructor;\n        case ls.CompletionItemKind.Field:\n            return mItemKind.Field;\n        case ls.CompletionItemKind.Variable:\n            return mItemKind.Variable;\n        case ls.CompletionItemKind.Class:\n            return mItemKind.Class;\n        case ls.CompletionItemKind.Interface:\n            return mItemKind.Interface;\n        case ls.CompletionItemKind.Module:\n            return mItemKind.Module;\n        case ls.CompletionItemKind.Property:\n            return mItemKind.Property;\n        case ls.CompletionItemKind.Unit:\n            return mItemKind.Unit;\n        case ls.CompletionItemKind.Value:\n            return mItemKind.Value;\n        case ls.CompletionItemKind.Enum:\n            return mItemKind.Enum;\n        case ls.CompletionItemKind.Keyword:\n            return mItemKind.Keyword;\n        case ls.CompletionItemKind.Snippet:\n            return mItemKind.Snippet;\n        case ls.CompletionItemKind.Color:\n            return mItemKind.Color;\n        case ls.CompletionItemKind.File:\n            return mItemKind.File;\n        case ls.CompletionItemKind.Reference:\n            return mItemKind.Reference;\n    }\n    return mItemKind.Property;\n}\nvar CompletionAdapter = /** @class */ (function () {\n    function CompletionAdapter(_worker) {\n        this._worker = _worker;\n    }\n    Object.defineProperty(CompletionAdapter.prototype, \"triggerCharacters\", {\n        get: function () {\n            return [':', '.'];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CompletionAdapter.prototype.provideCompletionItems = function (model, position, token) {\n        var resource = model.uri;\n        return wireCancellationToken(token, this._worker(resource)\n            .then(function (worker) {\n            var pos = fromPosition(position);\n            if (pos) {\n                return worker.doComplete(resource.toString(), pos);\n            }\n            return { isIncomplete: false, items: [] };\n        })\n            .then(function (cList) {\n            var items = cList.items.map(function (entry) {\n                var item = {\n                    label: entry.label,\n                    insertText: entry.insertText,\n                    sortText: entry.sortText,\n                    filterText: entry.filterText,\n                    documentation: entry.documentation,\n                    detail: entry.detail,\n                    kind: toCompletionItemKind(entry.kind),\n                };\n                if (entry.textEdit) {\n                    item.range = toRange(entry.textEdit.range);\n                    item.insertText = entry.textEdit.newText;\n                }\n                if (entry.insertTextFormat === ls.InsertTextFormat.Snippet) {\n                    item.insertText = { value: item.insertText };\n                }\n                return item;\n            });\n            return {\n                isIncomplete: cList.isIncomplete,\n                items: items,\n            };\n        }));\n    };\n    return CompletionAdapter;\n}());\nexport { CompletionAdapter };\n// ---- hover ----\nvar HoverAdapter = /** @class */ (function () {\n    function HoverAdapter(_worker) {\n        this._worker = _worker;\n    }\n    HoverAdapter.prototype.provideHover = function (model, position, token) {\n        var resource = model.uri;\n        return wireCancellationToken(token, this._worker(resource)\n            .then(function (worker) {\n            return worker.doHover(resource.toString(), fromPosition(position));\n        })\n            .then(function (info) {\n            if (!info) {\n                return;\n            }\n            return {\n                range: toRange(info.range),\n                contents: toMarkedStringArray(info.contents),\n            };\n        }));\n    };\n    return HoverAdapter;\n}());\nexport { HoverAdapter };\nfunction toMarkedStringArray(contents) {\n    if (!contents) {\n        return void 0;\n    }\n    if (Array.isArray(contents)) {\n        return contents.map(toMarkdownString);\n    }\n    return [toMarkdownString(contents)];\n}\nfunction toMarkdownString(entry) {\n    if (typeof entry === 'string') {\n        return {\n            value: entry,\n        };\n    }\n    if (isMarkupContent(entry)) {\n        if (entry.kind === 'plaintext') {\n            return {\n                value: entry.value.replace(/[\\\\`*_{}[\\]()#+\\-.!]/g, '\\\\$&'),\n            };\n        }\n        return {\n            value: entry.value,\n        };\n    }\n    return { value: '```' + entry.language + '\\n' + entry.value + '\\n```\\n' };\n}\nfunction isMarkupContent(thing) {\n    return thing && typeof thing === 'object' && typeof thing.kind === 'string';\n}\n/**\n * Hook a cancellation token to a WinJS Promise\n */\nfunction wireCancellationToken(token, promise) {\n    token.onCancellationRequested(function () { return promise.cancel(); });\n    return promise;\n}\n//# sourceMappingURL=languageFeatures.js.map","import WorkerManager from './workerManager';\nimport { CompletionAdapter, DiagnosticAdapter, HoverAdapter, monarchTokens } from './languageFeatures';\nexport function setupMode(defaults) {\n    var client = new WorkerManager(defaults);\n    var worker = function (first) {\n        var more = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            more[_i - 1] = arguments[_i];\n        }\n        return client.getLanguageServiceWorker.apply(client, [first].concat(more));\n    };\n    var languageId = defaults.languageId;\n    monaco.languages.setMonarchTokensProvider(languageId, monarchTokens);\n    monaco.languages.registerCompletionItemProvider(languageId, new CompletionAdapter(worker));\n    monaco.languages.registerHoverProvider(languageId, new HoverAdapter(worker));\n    // tslint:disable-next-line:no-unused-expression\n    new DiagnosticAdapter(languageId, worker, defaults);\n    return worker;\n}\n//# sourceMappingURL=gcMode.js.map"],"sourceRoot":""}